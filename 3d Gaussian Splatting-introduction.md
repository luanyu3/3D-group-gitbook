# 三维重建方法3D Gaussian Splatting简介
## Gaussian的基础知识
### 一维和三维的Gasussian
### v的概率密度函数
### x的概率密度函数
### 把变换矩阵A转换为协方差矩阵：
## 3D 高斯泼溅的整体流程
### 框架图
### 流程简介
Gaussian Splatting的输入是一组静态场景的图像，以及由SfM校准的相应摄像机，通过colmap产生一个稀疏点云作为衍生物。从初始的SfM点云出发，以每一个点为中心生成3D高斯分布，由位置（均值）、协方差矩阵和不透明度定义。然后利用相机参数把投影点投影到图像平面上（也就是splatting）。接下来从splatting的痕迹中进行快速光栅化，得到渲染的图像。将渲染的图像和Ground Trueth图像求loss。最后沿着蓝色的箭头进行反向传播，还有自适应的密度控制模块，最终传到每一个点上的梯度，决定是否需要克隆或者分裂。梯度同时会传播到Projection（协方差）中，更新其位置、协方差矩阵、球谐函数、不透明度等参数，完成一次迭代。
## 流程详解
### 关于“椭球”（即高斯/高斯球）的理解及形成：
1.“椭球”形象引入：

就像给 3 个顶点能表达任意一个 3D 三角形，继而很好的构建三维模型（ Mesh 的思想），研究者自然希望构建三维模型的基础元素能覆盖足够多样的几何体，而椭球就是一种很好的基础元素。
但是，只使用一个个实椭球来构建模型，是远远不够的。这时，我们就想寻找一种方式，来将椭球这种元素变得“强大”一点——能够构建出多样的表示。
那么，如果将椭球的边界变得不清晰，成为一个渐变的，可以融合的呢？如同真实世界中的“黑滴效应”：当你将两个物体慢慢相互靠近直到重叠时，这两个物体的影子之间的颜色会慢慢变深，形成黑滴状：

我们可以看到，如果这样的话，椭球就不再是那个有清晰边界的椭球了。继而，我们可以构建出更多样的表达。由此，我们便会想到概率分布，再由椭球的形状，我们又会想到同样是椭球状的三维高斯分布。

2.3D高斯椭球集的创建——位置与形状

我们要清楚的是3D高斯依旧是一个一个的点，每一个点都是一个3D高斯分布。一维的高斯是一个钟形曲线，二维的高斯是一个像小山包的形状，而三维高斯就像是一个椭球。而3D高斯只要做到一件事情，优化每一个点的参数。

每一个3D高斯的点都存储了以下信息：

Position（位置信息）：这是一个椭球的中心，也是高斯分布的均值，用u表示。

Covariance（协方差矩阵：Σ=RSS⊤R⊤）：次变量可以控制椭球的大小，形状和方向，用Σ表示。

Opacity（不透明度）：用于控制不透明度，用于Splatting时的渲染，用α表示。

Spherical harmonics（球谐函数）：球谐函数，你和视角相关的外观，用c表示。

3.3D高斯椭球集的创建——颜色和不透明度

颜色信息:点云颜色(r,g,b)--使用球谐函数来表示，使得点云在不同角度呈现不同颜色，并有利于提高迭代效率(代码中采用4阶)。

不透明度信息:点云不透明度，密度优化α。

**球谐函数**：
过程较为复杂，讲解详见b站《中恩实验室》视频：https://www.bilibili.com/video/BV1aw411E7bA?vd_source=25c0dee0c9a65590c654aa7f42c9d718
### splatting过程：
1.形象解释：在这一步中，三维高斯椭球体被投影到二维图像空间椭圆形，以进行渲染。
Splatting 的中文翻译为：抛雪球法。很形象，我们可以想象一下，把一个雪球（高斯球）扔到一个玻璃盘子上，雪球散开以后，在撞击中心的雪量（对图像的贡献）最大，而随着离撞击中心距离的增加，雪量（贡献） 减少。脑补一下盘子上的图像，其实我们可以自然而然的想到二维高斯分布的密度函数。

2.原理：从3D协方差矩阵Σ到2d协方差矩阵Σ′：Σ′=Jk​MΣMTJkT

具体推导过程可以参考文章：(https://zhuanlan.zhihu.com/p/666465701)

3.渲染方式：Tiled-based Rasterizer（快速可微光栅化）
* 确定视锥体
确定相机位姿进一步确定视锥体，有利于剔除视锥体以外的部分，防止出现浪费的计算。
* 3D->2D(splatting)
  - 该过程将3D空间内的3D椭球投影到2D空间中进行渲染，该过程主要对表示椭球的协方差矩阵乘上变换矩阵加以实现。类比到现实生活中，就好像将雪球用力掷向墙壁，啪的一声绽开，在墙上留下了一个中心密集，向四周逐渐变浅变稀疏的雪块,具体步骤为：
* 渲染过程的特点一：分块
  - 在处理图像时，为了减少对每个像素进行高斯运算的计算成本，论文采用了一种不同的方法:它不
是在像素级别进行精确计算，而是将精度降低到了更宏观的图块级别。这个过程首先涉及将整个图
像划分成多个不重看的小块，这些在原始的研究论文中被形象地称为“砖块”
。按照原始论文的建议，每个砖块包括 16 \times 16 个像素。
  - 接下来，会进一步识别出哪些砖块与特定的高斯投影相交。考虑到一个高斯投影可能会覆盖多个砖
块，一种有效的处理方式是复制这个东西，并为每个复制出的高斯分配一个唯一的标识符，即与之
相交的 Tie 的 ID。这样，每个砖块都与一个或多个高斯相关联，这些高斯标识了该砖块在图像中
的位置和重要性。通过这种方式，3DGS 能有效地降低计算复杂度，同时还保持了图像处理的效率
和准确性。
  - 概括来说就是，为了减少对每个像素进行高斯运算的计算成本，降低计算精度，把图像分成多给不重叠的小块，被称为“砖块”，每个砖块包括16个像素，然后，会进一步识别出哪些砖块与特定的高斯投影相交。一个高斯投影可能会覆盖多个砖块，处理方式就是为每个复制出的高斯分配一个唯一的标识符，即与之相交的 Tile 的 ID。每个砖块都与一个或多个高斯相关联，这些高斯标识了该砖块在图像中的位置和重要性和准确性。
* 渲染过程的特点二：排序
* 渲染公式：
  详细解析可参考：【3D Gaussian Splatting原理速通(三)--迭代参数与渲染】https://www.bilibili.com/video/BV1h5411y7ds?vd_source=25c0dee0c9a65590c654aa7f42c9d718
### loss公式及作用（损失函数）
* 其中λ是一个权重因子，一般取0.2，loss公式主要是用于渲染的图像和Ground Trueth图像求loss，然后进行一个梯度回传，更新高斯球的位置、协方差矩阵、球谐函数、不透明度等参数
### 参数更新 
### 自适应密度控制
### 伪代码流程
### 部分背景知识
